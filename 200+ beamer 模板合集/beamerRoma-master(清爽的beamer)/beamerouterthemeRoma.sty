% Roma Beamer Theme - Claudio Fiandrino
% Reworked by Matteo Ipri
\mode<presentation>

% String used between the current frame and the total frame number
\def\beamer@Roma@pageofpages{}
\DeclareOptionBeamer{pageofpages}{\def\beamer@Roma@pageofpages{#1}}
\ExecuteOptionsBeamer{pageofpages=of}

% Line below the frame title
\DeclareOptionBeamer{titleline}[false]{\def\beamer@Roma@titleline{#1}}
\ExecuteOptionsBeamer{titleline=true}
\ProcessOptionsBeamer

% Lengths
\newlength{\beamer@Roma@line}
\setlength{\beamer@Roma@line}{.02\paperheight}
\newlength{\beamer@Roma@linebar}
\setlength{\beamer@Roma@linebar}{.03\paperheight}

% Header
\defbeamertemplate*{headline}{Roma theme}
{%
  \ifnum\thepage>1\relax%
  \begin{beamercolorbox}[colsep=1.5pt]{upper separation line head}
  \end{beamercolorbox}
  \begin{beamercolorbox}{section in head/foot}
    \vskip2pt\insertsectionnavigationhorizontal{\paperwidth}{}{}\vskip2pt
  \end{beamercolorbox}%
%  \ifbeamer@theme@subsection%
%    \begin{beamercolorbox}[colsep=1.5pt]{middle separation line head}
%    \end{beamercolorbox}
%    \begin{beamercolorbox}[ht=2.5ex,dp=1.125ex,%
%      leftskip=.3cm,rightskip=.3cm plus1fil]{subsection in head/foot}
%      \usebeamerfont{subsection in head/foot}\insertsubsectionhead
%    \end{beamercolorbox}%
%  \fi%
  \begin{beamercolorbox}[colsep=1.5pt]{lower separation line head}
  \end{beamercolorbox}
  \else
  \fi
}

% Footer
\defbeamertemplate*{footline}{Roma theme}
{
  \leavevmode%
  % First line
  \hbox{%
  \begin{beamercolorbox}[wd=.2\paperwidth,ht=\beamer@Roma@line,dp=0pt]{}%
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.8\paperwidth,ht=\beamer@Roma@line,dp=0pt]{line}%
  \end{beamercolorbox}%
  } %
  % Second line
  \hbox{%
  \begin{beamercolorbox}[leftskip=\beamer@Roma@normalmargin,rightskip=\beamer@Roma@normalmargin,wd=\paperwidth,ht=\beamer@Roma@linebar,dp=0pt,sep=0.5pt]{linebar}%
  \tiny{\insertshorttitle\hfill\insertshortdate\hfill
  \insertframenumber\hskip1pt\beamer@Roma@pageofpages\hskip1pt\inserttotalframenumber}%
  \end{beamercolorbox}%
  } %
  % Third line
  \hbox{%
  \begin{beamercolorbox}[wd=\paperwidth,ht=\beamer@Roma@line,dp=0pt]{line}%
  \end{beamercolorbox}%
  }% 
}

\defbeamertemplate*{frametitle}{Roma theme}[1][left]
{
  \vskip-\beamer@Roma@line
  \ifbeamercolorempty[bg]{frametitle}{}{\nointerlineskip}%
  \@tempdima=\textwidth%
  \advance\@tempdima by\beamer@leftmargin%
  \advance\@tempdima by\beamer@rightmargin%
  \vbox{}\vskip-.5\beamer@leftmargin%
  \begin{beamercolorbox}[sep=\beamer@leftmargin,#1,wd=\the\@tempdima]{}
    \usebeamerfont{frametitle}\usebeamercolor[bg]{framesubtitle}%
    \vbox{}\vskip0ex%
    \if@tempswa\else\csname beamer@fte#1\endcsname\fi%
    \strut\insertframetitle\strut\par%
    {%
      \ifx\insertframesubtitle\@empty%
      \else%
      {\usebeamerfont{framesubtitle}\usebeamercolor[bg]{framesubtitle}\insertframesubtitle\strut\par}%
      \fi
    }%
    \vskip-1ex%
    \if@tempswa\else\vskip-\beamer@leftmargin\fi
  \end{beamercolorbox}%
  \def\beamer@Roma@truetext{true}%
  \ifx\beamer@Roma@titleline\beamer@Roma@truetext%
    \vskip-.5\beamer@leftmargin%
    \begin{beamercolorbox}[wd=\textwidth,ht=.1ex,dp=0ex]{titleline}%
    \end{beamercolorbox}%
  \fi
}

% Frame title continuation
\defbeamertemplate*{frametitle continuation}{Roma theme}{(\insertcontinuationcount)}

\mode
<all>
